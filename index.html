<script>
  console.log("üì° Iniciando scanner...");

  const html5QrCode = new Html5Qrcode("reader");
  html5QrCode.start(
    {facingMode: "environment"},
    {fps: 10, qrbox: 250},
    async decodedText => {
      console.log("‚úÖ QR Code lido:", decodedText);
      html5QrCode.stop();
      alert("Enviando nota para valida√ß√£o...");

      fetch("https://midiasocialpam.wixsite.com/ebookcampeao/_functions/register", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ chave: decodedText })
      })
      .then(response => {
        console.log("üì• Resposta recebida do Wix:", response);
        return response.json();
      })
      .then(res => {
        console.log("üì¶ Resposta JSON do Wix:", res);
        if (res.ok) {
          alert("‚úÖ Pontos creditados: +" + res.pontos);
        } else {
          alert("‚ö†Ô∏è Erro: " + res.msg);
        }
      })
      .catch(error => {
        console.error("‚ùå Erro na requisi√ß√£o:", error);
        alert("Erro ao enviar dados para o Wix");
      });
    }
  );
</script>
<!DOCTYPE html>
<html>
<head>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
</head>
<body>
  <div id="reader" style="width:100%;"></div>
  <script>
    const html5QrCode = new Html5Qrcode("reader");
    html5QrCode.start(
      {facingMode: "environment"},
      {fps: 10, qrbox: 250},
      async decodedText => {
        html5QrCode.stop();
        alert("Enviando nota para valida√ß√£o...");
        console.log("‚úÖ QR Code lido:", decodedText);

        fetch("https://midiasocialpam.wixsite.com/ebookcampeao/_functions/register", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ chave: decodedText })
        })
        .then(response => {
          console.log("üì• Resposta recebida do Wix:", response);
          return response.json();
        })
        .then(res => {
          console.log("üì¶ Resposta JSON do Wix:", res);
          if (res.ok) {
            alert("‚úÖ Pontos creditados: +" + res.pontos);
          } else {
            alert("‚ö†Ô∏è Erro: " + res.msg);
          }
        })
        .catch(error => {
          console.error("‚ùå Erro na requisi√ß√£o:", error);
          alert("Erro ao enviar dados para o Wix");
        });
      }
    );
  </script>
</body>
</html>
