<!DOCTYPE html>
<html>
<head>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
</head>
<body>
  <div id="reader" style="width:100%;"></div>
  <script>
    const html5QrCode = new Html5Qrcode("reader");
    html5QrCode.start(
      {facingMode: "environment"},
      {fps: 10, qrbox: 250},
      async decodedText => {
        html5QrCode.stop();
        alert("Enviando nota para validação...");

        fetch("https://midiasocialpam.wixsite.com/ebookcampeao/_functions/register", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ chave: decodedText })
        })
        .then(response => response.json())
        .then(res => {
          if (res.ok) {
            alert("✅ Pontos creditados: +" + res.pontos);
          } else {
            alert("⚠️ Erro: " + res.msg);
          }
        })
        .catch(error => {
          console.error(error);
          alert("Erro ao enviar dados para o Wix");
        });
      }
    );
  </script>
</body>
</html>
